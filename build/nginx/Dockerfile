FROM nginx:alpine

COPY ./nginx/init_command.sh /etc/nginx/init_command.sh

# USWGI pass ports
ENV DASHBOARD_APP_PORT 8000
ENV CONTROLLER_APP_PORT 8001
ENV RADIUS_APP_PORT 8002
ENV TOPOLOGY_APP_PORT 8003
# Listen ports
ENV OPENWISP_DASHBOARD_LISTEN_PORT 8080
ENV OPENWISP_CONTROLLER_LISTEN_PORT 8081
ENV OPENWISP_RADIUS_LISTEN_PORT 8082
ENV OPENWISP_TOPOLOGY_LISTEN_PORT 8083
EXPOSE ${OPENWISP_DASHBOARD_LISTEN_PORT}
EXPOSE ${OPENWISP_CONTROLLER_LISTEN_PORT}
EXPOSE ${OPENWISP_RADIUS_LISTEN_PORT}
EXPOSE ${OPENWISP_TOPOLOGY_LISTEN_PORT}

COPY ./nginx/nginx.template.conf /etc/nginx/nginx.template.conf
RUN chmod +x /etc/nginx/init_command.sh

CMD /etc/nginx/init_command.sh
